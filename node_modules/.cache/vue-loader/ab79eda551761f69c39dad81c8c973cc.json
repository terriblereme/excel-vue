{"remainingRequest":"E:\\excel\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!E:\\excel\\src\\views\\mobile\\rigister\\register.vue?vue&type=style&index=0&id=60c46af8&lang=scss&scoped=true","dependencies":[{"path":"E:\\excel\\src\\views\\mobile\\rigister\\register.vue","mtime":1672900703668},{"path":"E:\\excel\\node_modules\\css-loader\\dist\\cjs.js","mtime":1669859218329},{"path":"E:\\excel\\node_modules\\vue-loader-v16\\dist\\stylePostLoader.js","mtime":1669859219000},{"path":"E:\\excel\\node_modules\\postcss-loader\\src\\index.js","mtime":1669859218625},{"path":"E:\\excel\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1669859218094},{"path":"E:\\excel\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1669859218110},{"path":"E:\\excel\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1669859218719}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQoubm90aWNlLWRpdnsNCiAgd2lkdGg6IDgwdnc7DQogIHBhZGRpbmc6IDUuMzMzM3Z3Ow0KICAudGl0bGV7DQogICAgZm9udC1zaXplOiA0dnc7DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgIGZvbnQtd2VpZ2h0OiA2MDA7DQogICAgbGV0dGVyLXNwYWNpbmc6IDAuMjY2N3Z3Ow0KICAgIG1hcmdpbi1ib3R0b206IDUuMzMzM3Z3Ow0KICB9DQogIC5jb250ZW50ew0KICAgIGZvbnQtc2l6ZTogMy40NjY3dnc7DQogICAgbWluLWhlaWdodDogNTB2aDsNCiAgICBtYXJnaW4tYm90dG9tOiA1LjMzMzN2dzsNCiAgfQ0KICAuZWwtYnV0dG9uew0KICAgIHdpZHRoOiAxMDAlOw0KICB9DQoNCn0NCg=="},{"version":3,"sources":["E:\\excel\\src\\views\\mobile\\rigister\\register.vue"],"names":[],"mappings":";AAkYA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;EACT,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;EACX,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;EACjB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACJ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;IACd,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IAClB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;IAChB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACxB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;EACzB;EACA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACN,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACnB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;IAChB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;EACzB;EACA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACR,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;EACb;;AAEF","file":"E:/excel/src/views/mobile/rigister/register.vue","sourceRoot":"","sourcesContent":["<template>\r\n  <vnp-keyboard\r\n    v-model=\"dataForm.visitingVehicle\"\r\n    v-model:show=\"show\"\r\n  ></vnp-keyboard>\r\n  <div class=\"con-main bangs-bg\">\r\n    <el-form\r\n      :model=\"dataForm\"\r\n      ref=\"dataForm\"\r\n      :rules=\"saveRules\"\r\n      label-position=\"top\"\r\n      class=\"main-form\"\r\n    >\r\n      <div v-for=\"(item, index) in saveDataForm\" :key=\"index\">\r\n      <label style=\"color:#409eff\" @click=\"changeList(index)\">\r\n        点击填写第{{index+1}}位访客信息\r\n      </label>\r\n      <div  v-if=\"showVisitorList==index\">\r\n      <el-form-item label=\"访客姓名\" prop=\"visitingName\">\r\n        <el-input v-model=\"dataForm.visitingName\" maxlength=\"50\" />\r\n      </el-form-item>\r\n      <el-form-item label=\"访客电话\" prop=\"visitingPhone\">\r\n        <el-input v-model=\"dataForm.visitingPhone\" maxlength=\"11\" />\r\n      </el-form-item>\r\n      <el-form-item label=\"身份证号\" prop=\"visitingNumber\">\r\n        <el-input v-model=\"dataForm.visitingNumber\" maxlength=\"18\" />\r\n      </el-form-item>\r\n      <el-form-item label=\"访客单位\" prop=\"visitingDept\">\r\n        <el-input v-model=\"dataForm.visitingDept\" maxlength=\"50\" />\r\n      </el-form-item>\r\n      <el-form-item label=\"车牌号\">\r\n        <el-input\r\n          v-model=\"dataForm.visitingVehicle\"\r\n          maxlength=\"8\"\r\n          @click=\"show = true\"\r\n          readonly\r\n        >\r\n        </el-input>\r\n      </el-form-item>\r\n      <el-form-item label=\"来访时间\" prop=\"visitingTime\">\r\n        <el-input\r\n          v-model=\"dataForm.visitingTime\"\r\n          @focus=\"showDatetimePicker = true\"\r\n          readonly\r\n        />\r\n        <van-popup :show=\"showDatetimePicker\" round position=\"bottom\">\r\n          <van-datetime-picker\r\n            type=\"datetime\"\r\n            v-model=\"currentDate\"\r\n            @cancel=\"showDatetimePicker = false\"\r\n            @confirm=\"confirmDateTime\"\r\n          />\r\n        </van-popup>\r\n      </el-form-item>\r\n      <el-form-item label=\"受访人\" prop=\"interviewee\">\r\n        <el-input\r\n          v-model=\"dataForm.intervieweeName\"\r\n          @focus=\"showPicker = true\"\r\n          readonly\r\n        />\r\n        <van-popup :show=\"showPicker\" round position=\"bottom\" teleport=\"#app\">\r\n          <van-cascader\r\n            v-model=\"dataForm.interviewee\"\r\n            title=\"请选择受访人\"\r\n            :options=\"depts\"\r\n            :field-names=\"{ text: 'name', value: 'id', children: 'children' }\"\r\n            @close=\"showPicker = false\"\r\n            @change=\"onChange\"\r\n            @finish=\"onConfirm\"\r\n          />\r\n        </van-popup>\r\n      </el-form-item>\r\n      <el-form-item label=\"来访事由\" prop=\"visitingReason\">\r\n        <el-input v-model=\"dataForm.visitingReason\" maxlength=\"200\" />\r\n      </el-form-item>\r\n      <!-- <el-form-item label=\"请上传照片\" >\r\n        <el-upload\r\n          class=\"avatar-uploader\"\r\n          action=\"\"\r\n          :show-file-list=\"false\"\r\n          :before-upload=\"(file)=>beforeAvatarUpload(file,'photo')\"\r\n          v-loading=\"loading\"\r\n        >\r\n          <el-image\r\n            v-if=\"dataForm.photo\"\r\n            :src=\"dataForm.photo\"\r\n            fit=\"cover\"\r\n          ></el-image>\r\n          <div v-else class=\"avatar-else\">\r\n            <el-icon class=\"avatar-uploader-icon\"><circle-plus /></el-icon>\r\n            <span> 点击上传 </span>\r\n          </div>\r\n        </el-upload>\r\n      </el-form-item> -->\r\n      <el-form-item label=\"请上传八闽健康码\" >\r\n        <el-upload\r\n          class=\"avatar-uploader\"\r\n          action=\"\"\r\n          :show-file-list=\"false\"\r\n          :before-upload=\"(file) => beforeAvatarUpload(file, 'code1')\"\r\n          v-loading=\"loading\"\r\n        >\r\n          <el-image\r\n            v-if=\"dataForm.code1\"\r\n            :src=\"dataForm.code1\"\r\n            fit=\"cover\"\r\n          ></el-image>\r\n          <div v-else class=\"avatar-else\">\r\n            <el-icon class=\"avatar-uploader-icon\"><circle-plus /></el-icon>\r\n            <span> 点击上传 </span>\r\n          </div>\r\n        </el-upload>\r\n      </el-form-item>\r\n      <el-form-item label=\"请上传核酸检测报告\" >\r\n        <el-upload\r\n          class=\"avatar-uploader\"\r\n          action=\"\"\r\n          :show-file-list=\"false\"\r\n          :before-upload=\"(file) => beforeAvatarUpload(file, 'code3')\"\r\n          v-loading=\"loading\"\r\n        >\r\n          <el-image\r\n            v-if=\"dataForm.code3\"\r\n            :src=\"dataForm.code3\"\r\n            fit=\"cover\"\r\n          ></el-image>\r\n          <div v-else class=\"avatar-else\">\r\n            <el-icon class=\"avatar-uploader-icon\"><circle-plus /></el-icon>\r\n            <span> 点击上传 </span>\r\n          </div>\r\n        </el-upload>\r\n      </el-form-item>\r\n      </div>\r\n      <div class=\"bottom-btn\">\r\n        <el-button v-if=\"index !== 0\"  type=\"danger\" size=\"mini\" @click=\"deleteItem(item,index)\">\r\n          删除该条访客信息\r\n        </el-button>\r\n      </div>\r\n      <div class=\"bottom-btn\">\r\n        <el-button v-if=\"index+1== saveDataForm.length\" type=\"primary\" size=\"primary\" @click=\"addItem(index)\">\r\n          <el-icon class=\"avatar-uploader-icon\"><circle-plus /></el-icon>\r\n          <span> 添加其他来访人员 </span>\r\n        </el-button>\r\n      </div>\r\n      </div>\r\n    </el-form>\r\n     <el-checkbox v-model=\"checked\">本人已阅读并理解<label style=\"color:#409eff\" @click=\"showNotice=true\">《入园需知》</label>，同意遵守</el-checkbox>\r\n     <van-popup v-model:show=\"showNotice\" round>\r\n       <div class=\"notice-div\">\r\n         <div class=\"title\">入园需知</div>\r\n         <div class=\"content\" v-html=\"notice\"></div>\r\n         <el-button type=\"primary\" round @click=\"showNotice = false\">关闭</el-button>\r\n       </div>\r\n       </van-popup>\r\n    <div class=\"bottom-btn\">\r\n      <el-button v-if=\"checked\" type=\"primary\" round @click=\"loopSave\">提交</el-button>\r\n      <el-button v-else type=\"info\" round  disabled>提交</el-button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { deptList, userList, registerSave,getCompany } from \"@/api/protal\";\r\nimport { upload } from \"@/api/admin\";\r\nimport Keyboard from \"@/components/vnp-keyboard.vue\";\r\nvar moment = require(\"moment\");\r\nexport default {\r\n  components: {\r\n    \"vnp-keyboard\": Keyboard,\r\n  },\r\n  data() {\r\n    return {\r\n      loading: false,\r\n      showVisitorList:\"0\",\r\n      tempIndex:0,\r\n      show: false,\r\n      showKeyboard: true,\r\n      currentDate: new Date(),\r\n      depts: [],\r\n      dataForm: {},\r\n      showPicker: false,\r\n      showDatetimePicker: false,\r\n      checked:false,\r\n      showNotice:false,\r\n      notice:\"\",\r\n      saveDataForm: [\r\n        {\r\n          visitingName:\"\",\r\n          visitingPhone:\"\",\r\n          visitingNumber:\"\",\r\n          visitingDept:\"\",\r\n          visitingVehicle:\"\",\r\n          visitingTime:\"\",\r\n          intervieweeUnit:\"\",\r\n          interviewee:\"\",\r\n          intervieweeName:\"\",\r\n          intervieweeDept:\"\",\r\n          intervieweeDeptName:\"\",\r\n          visitingReason:\"\",\r\n          code1:\"\",\r\n          code2:\"\",\r\n          code3:\"\",\r\n        }\r\n        ],\r\n        saveRules: {\r\n        visitingName: [\r\n          { required: true, trigger: \"blur\", message: \"请输入访客姓名\" },\r\n        ],\r\n        visitingPhone: [\r\n          { required: true, trigger: \"blur\", message: \"请输入手机号码\" },\r\n          {\r\n            type: \"number\",\r\n            trigger: \"blur\",\r\n            message: \"请输入正确的手机号码\",\r\n            transform(value) {\r\n              if (!/^1[3-9][0-9]{9}$/.test(value)) return false;\r\n            },\r\n          },\r\n        ],\r\n        visitingNumber: [\r\n          { required: true, trigger: \"blur\", message: \"请输入身份证号码\" },\r\n          {\r\n            trigger: \"blur\",\r\n            message: \"请输入正确的身份证号码\",\r\n            transform(value) {\r\n              if (!/^(\\d{6})(\\d{4})(\\d{2})(\\d{2})(\\d{3})([0-9]|X)$/.test(value))\r\n                return false;\r\n            },\r\n          },\r\n        ],\r\n        visitingDept: [\r\n          { required: true, trigger: \"blur\", message: \"请输入访客单位\" },\r\n        ],\r\n        visitingTime: [\r\n          { required: true, trigger: \"change\", message: \"请输入来访时间\" },\r\n        ],\r\n        interviewee: [\r\n          { required: true, trigger: \"change\", message: \"请选择受访人\" },\r\n        ],\r\n        visitingReason: [\r\n          { required: true, trigger: \"blur\", message: \"请输入来访事由\" },\r\n        ],\r\n\r\n      },\r\n    };\r\n  },\r\n  methods: {\r\n  \r\n    beforeAvatarUpload(file, prop) {\r\n      let suffix = file.name\r\n        .substring(file.name.lastIndexOf(\".\") + 1)\r\n        .toLowerCase();\r\n      const isJPG = [\"jpg\", \"png\", \"jpeg\"].includes(suffix);\r\n      const isLt2M = file.size / 1024 / 1024 < 5;\r\n      if (!isJPG) {\r\n        this.$message.error(\"图片格式仅支持JPG和PNG\");\r\n        return false;\r\n      }\r\n      if (!isLt2M) {\r\n        this.$message.error(\"图片大小不可超过 2MB!\");\r\n        return false;\r\n      }\r\n      if (isJPG && isLt2M) {\r\n        this.loading = true;\r\n        upload(file).then((res) => {\r\n          this.loading = false;\r\n          if (res.code == 1) {\r\n            this.dataForm[prop] = res.data.path;\r\n          } else {\r\n            this.$message.error(res.msg);\r\n          }\r\n        });\r\n      }\r\n      return false;\r\n    },\r\n    loadDepts() {\r\n      deptList().then((res) => {\r\n        this.depts = res.data;\r\n      });\r\n    },\r\n    loadNotice(){\r\n      getCompany(2).then((res)=>{\r\n        this.notice = res.data.intro\r\n      })\r\n    },\r\n    onChange(value) {\r\n      let selected = value.selectedOptions[value.selectedOptions.length - 1];\r\n      if (selected.children &&!selected.isLoad) {\r\n        selected.isLoad = true;\r\n        userList({ deptId: selected.id }).then((res) => {\r\n          let users = res.data.map((item) => {\r\n            item.name = item.nickName;\r\n            return item;\r\n          });\r\n          selected.children.push(...users);\r\n        });\r\n      }\r\n    },\r\n    onConfirm(value) {\r\n      this.dataForm.intervieweeUnit = value.selectedOptions[0].name;\r\n      let selected = value.selectedOptions[value.selectedOptions.length - 1];\r\n      this.dataForm.interviewee = selected.id;\r\n      this.dataForm.intervieweeName = selected.name;\r\n      this.dataForm.intervieweeDept = selected.deptId;\r\n      this.dataForm.intervieweeDeptName = selected.deptName;\r\n      this.showPicker = false;\r\n    },\r\n    confirmDateTime(value) {\r\n      this.dataForm.visitingTime = moment(value).format(\"yyyy-MM-DD HH:mm\");\r\n      this.showDatetimePicker = false;\r\n    },\r\n    handleSave() {\r\n      this.$refs.dataForm.validate((valid) => {\r\n        this.dataForm.openid = this.$store.state.openid;\r\n        if (valid) {\r\n          registerSave(this.dataForm);\r\n        }\r\n      });\r\n    },\r\n    loopSave(){\r\n      this.$refs.dataForm.validate((valid) => {\r\n        this.dataForm.openid = this.$store.state.openid;\r\n        if (valid) {\r\n          this.saveDataForm[this.tempIndex]=this.dataForm\r\n          let len=this.saveDataForm.length\r\n          for (let i=0;i<len;i++){\r\n            this.dataForm=this.saveDataForm[i]\r\n            registerSave(this.dataForm);\r\n          }\r\n        }\r\n      });\r\n          this.$router.push(\"/mobile/home\");\r\n    },\r\n    changeList(index){\r\n      //let obj={}\r\n      this.saveDataForm[this.tempIndex]=this.dataForm\r\n      this.dataForm=this.saveDataForm[index]\r\n      this.showVisitorList=index\r\n      //this.changeDataForm(index)\r\n      this.tempIndex=index\r\n\r\n    },\r\n    deleteItem(item,index){\r\n      this.saveDataForm.splice(index,1)\r\n      this.showVisitorList=this.showVisitorList-1\r\n      this.tempIndex=this.tempIndex-1\r\n    },\r\n    addItem(index){\r\n      let itemObj={\r\n        visitingName:\"\",\r\n        visitingPhone:\"\",\r\n        visitingNumber:\"\",\r\n        visitingDept:this.dataForm.visitingDept,\r\n        visitingVehicle:this.dataForm.visitingVehicle,\r\n        visitingTime:this.dataForm.visitingTime,\r\n        intervieweeUnit:this.dataForm.intervieweeUnit,\r\n        interviewee:this.dataForm.interviewee,\r\n        intervieweeName:this.dataForm.intervieweeName,\r\n        intervieweeDept:this.dataForm.interviewee,\r\n        intervieweeDeptName:this.dataForm.intervieweeName,\r\n        visitingReason:this.dataForm.visitingReason,\r\n        code1:\"\",\r\n        code2:\"\",\r\n        code3:\"\",\r\n      }\r\n      this.$refs.dataForm.validate((valid) => {\r\n        this.dataForm.openid = this.$store.state.openid;\r\n        if (valid) {\r\n          this.showVisitorList=index+1\r\n          this.tempIndex=index+1\r\n          this.saveDataForm[index]=this.dataForm\r\n          this.dataForm=itemObj\r\n          this.saveDataForm.push(itemObj)\r\n       }\r\n      });\r\n    },\r\n\r\n  },\r\n  mounted() {\r\n    this.loadDepts();\r\n    this.loadNotice();\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.notice-div{\r\n  width: 80vw;\r\n  padding: 5.3333vw;\r\n  .title{\r\n    font-size: 4vw;\r\n    text-align: center;\r\n    font-weight: 600;\r\n    letter-spacing: 0.2667vw;\r\n    margin-bottom: 5.3333vw;\r\n  }\r\n  .content{\r\n    font-size: 3.4667vw;\r\n    min-height: 50vh;\r\n    margin-bottom: 5.3333vw;\r\n  }\r\n  .el-button{\r\n    width: 100%;\r\n  }\r\n\r\n}\r\n</style>"]}]}